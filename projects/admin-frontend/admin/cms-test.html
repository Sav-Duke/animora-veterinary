<!DOCTYPE html>
<html lang="en">
<head>
    <script>
      window.VITE_API_URL = window.VITE_API_URL || (typeof import !== 'undefined' && import.meta && import.meta.env && import.meta.env.VITE_API_URL) || '';
    </script>
  <meta charset="UTF-8">
  <title>CMS Test Page | Animora</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      border-radius: 12px;
      margin-bottom: 30px;
      text-align: center;
    }
    .test-section {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .test-section h2 {
      color: #16A34A;
      margin-top: 0;
    }
    .status {
      display: inline-block;
      padding: 5px 15px;
      border-radius: 20px;
      font-weight: bold;
      margin-left: 10px;
    }
    .status.loading {
      background: #fbbf24;
      color: #78350f;
    }
    .status.success {
      background: #86efac;
      color: #14532d;
    }
    .status.error {
      background: #fca5a5;
      color: #7f1d1d;
    }
    pre {
      background: #f3f4f6;
      padding: 15px;
      border-radius: 6px;
      overflow-x: auto;
      max-height: 300px;
      overflow-y: auto;
    }
    .btn {
      background: #16A34A;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1rem;
      margin-right: 10px;
    }
    .btn:hover {
      background: #15803d;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>ğŸ§ª CMS API Test Page</h1>
    <p>Test all CMS endpoints to ensure everything is working correctly</p>
  </div>

  <div style="margin-bottom: 20px;">
    <button class="btn" onclick="testAll()">ğŸ”„ Test All Endpoints</button>
    <button class="btn" onclick="location.href='/admin/'">â† Back to Admin</button>
  </div>

  <div class="test-section">
    <h2>ğŸ“Š API Endpoint Tests</h2>
    
    <div id="staffTest">
      <h3>ğŸ‘¥ Staff API <span class="status loading">Testing...</span></h3>
      <pre id="staffResult">Waiting for test...</pre>
    </div>

    <div id="servicesTest">
      <h3>ğŸ¥ Services API <span class="status loading">Testing...</span></h3>
      <pre id="servicesResult">Waiting for test...</pre>
    </div>

    <div id="contactTest">
      <h3>ğŸ“ Contact Info API <span class="status loading">Testing...</span></h3>
      <pre id="contactResult">Waiting for test...</pre>
    </div>

    <div id="aboutTest">
      <h3>ğŸ“ About Content API <span class="status loading">Testing...</span></h3>
      <pre id="aboutResult">Waiting for test...</pre>
    </div>
  </div>

  <div class="test-section">
    <h2>ğŸ“ˆ Summary</h2>
    <div id="summary">
      <p>Run tests to see results...</p>
    </div>
  </div>

  <script>
    async function testEndpoint(name, url, resultId, statusSelector) {
      try {
        const response = await fetch(url);
        const data = await response.json();
        
        document.getElementById(resultId).textContent = JSON.stringify(data, null, 2);
        document.querySelector(statusSelector).textContent = 'âœ… Success';
        document.querySelector(statusSelector).className = 'status success';
        
        return { name, success: true, records: Array.isArray(data) ? data.length : Object.keys(data).length };
      } catch (error) {
        document.getElementById(resultId).textContent = 'Error: ' + error.message;
        document.querySelector(statusSelector).textContent = 'âŒ Failed';
        document.querySelector(statusSelector).className = 'status error';
        
        return { name, success: false, error: error.message };
      }
    }

    async function testAll() {
      const results = await Promise.all([
          testEndpoint('Staff', `${apiBase}/resources?type=staff`, 'staffResult', '#staffTest .status'),
          testEndpoint('Services', `${apiBase}/resources?type=services`, 'servicesResult', '#servicesTest .status'),
          testEndpoint('Contact Info', `${apiBase}/resources?type=contact-info`, 'contactResult', '#contactTest .status'),
        testEndpoint('About Content', '/api/resources?type=about-content', 'aboutResult', '#aboutTest .status')
      ]);

      const successful = results.filter(r => r.success).length;
      const failed = results.filter(r => !r.success).length;

      let summaryHTML = `
        <h3>Test Results</h3>
        <p><strong>Total Tests:</strong> ${results.length}</p>
        <p><strong>Passed:</strong> <span style="color: #16A34A;">${successful}</span></p>
        <p><strong>Failed:</strong> <span style="color: #ef4444;">${failed}</span></p>
        <hr>
        <h4>Details:</h4>
        <ul>
      `;

      results.forEach(result => {
        if (result.success) {
          summaryHTML += `<li>âœ… <strong>${result.name}:</strong> ${result.records} record(s) found</li>`;
        } else {
          summaryHTML += `<li>âŒ <strong>${result.name}:</strong> ${result.error}</li>`;
        }
      });

      summaryHTML += `</ul>`;

      if (failed === 0) {
        summaryHTML += `<p style="color: #16A34A; font-weight: bold; font-size: 1.2rem;">ğŸ‰ All tests passed! CMS is working correctly.</p>`;
      } else {
        summaryHTML += `<p style="color: #ef4444; font-weight: bold;">âš ï¸ Some tests failed. Check the server and data files.</p>`;
      }

      document.getElementById('summary').innerHTML = summaryHTML;
    }

    // Auto-run tests on page load
    window.addEventListener('load', () => {
      setTimeout(testAll, 500);
    });
  </script>
</body>
</html>
