<!DOCTYPE html>
<html lang="en">
<head>
    <style>
      .help-icon {
        display: inline-block;
        margin-left: 6px;
        color: #16A34A;
        font-size: 1.1rem;
        cursor: pointer;
        vertical-align: middle;
        transition: color 0.2s;
      }
      .help-icon:hover {
        color: #15803d;
      }
      .tooltip {
        display: none;
        position: absolute;
        background: #fff;
        color: #222;
        border: 1px solid #16A34A;
        border-radius: 6px;
        padding: 10px 14px;
        font-size: 0.98rem;
        z-index: 1000;
        box-shadow: 0 2px 12px rgba(22,163,74,0.08);
        max-width: 260px;
        line-height: 1.5;
      }
    </style>
  <meta charset="UTF-8">
  <title>Admin Panel | Animora Farm Health</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../styles/main.css">
  
  <!-- Admin Password Protection -->
  <script>
    (async function() {
      // Check if user is authenticated in this session
      const isAuthenticated = sessionStorage.getItem('animoraAdminAuth');
      if (isAuthenticated !== 'true') {
        // Prompt for password
        const enteredPassword = prompt('üîí Admin Access Required\n\nEnter Admin Password:');
        if (!enteredPassword) {
          alert('‚ùå Access Denied: No Password Entered');
          window.location.href = '../index.html';
          return;
        }
        // Call backend for authentication
        try {
          const resp = await fetch('/api/main?action=admin-login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ password: enteredPassword })
          });
          const data = await resp.json();
          if (data.success) {
            sessionStorage.setItem('animoraAdminAuth', 'true');
          } else {
            alert('‚ùå Access Denied: Incorrect Password');
            window.location.href = '../index.html';
          }
        } catch (e) {
          alert('‚ùå Access Denied: Server Error');
          window.location.href = '../index.html';
        }
      }
    })();
  </script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .admin-container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      padding: 40px;
      max-width: 900px;
      width: 100%;
    }

    .admin-header {
      text-align: center;
      margin-bottom: 40px;
    }

    .admin-header h1 {
      color: #16A34A;
      margin-bottom: 10px;
      font-size: 2.5rem;
    }

    .admin-header p {
      color: #666;
      font-size: 1.1rem;
    }

    .admin-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .admin-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      border-radius: 8px;
      text-align: center;
      cursor: pointer;
      transition: transform 0.3s, box-shadow 0.3s;
      text-decoration: none;
      display: block;
    }

    .admin-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
    }

    .admin-card h3 {
      margin: 0 0 10px 0;
      font-size: 1.5rem;
    }

    .admin-card p {
      margin: 0;
      opacity: 0.9;
    }

    .admin-card.ai {
      background: linear-gradient(135deg, #16A34A 0%, #15803d 100%);
    }

    .admin-card.database {
      background: linear-gradient(135deg, #0891b2 0%, #0e7490 100%);
    }

    .admin-card.website {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    }

    .admin-card.analytics {
      background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
    }

    .icon {
      font-size: 3rem;
      margin-bottom: 15px;
    }

    .status-bar {
      background: #f3f4f6;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
    }

    .status-bar h4 {
      margin: 0 0 10px 0;
      color: #374151;
    }

    .status-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #e5e7eb;
    }

    .status-item:last-child {
      border-bottom: none;
    }

    .status-indicator {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 5px;
    }

    .status-indicator.online {
      background: #10b981;
    }

    .status-indicator.offline {
      background: #ef4444;
    }

    .logout-btn {
      background: #ef4444;
      color: white;
      padding: 12px 30px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      margin-top: 20px;
      display: block;
      width: 100%;
      transition: background 0.3s;
    }

    .logout-btn:hover {
      background: #dc2626;
    }
  </style>
</head>
<body>
  <div class="admin-container">
    <div class="admin-header">
      <h1>üè• Animora Admin Panel</h1>
      <p>Manage your Farm Health's AI system and website</p>
    </div>

    <div class="admin-grid" id="adminGrid">
      <!-- Admin cards with help icons will be injected by JS for tooltips -->
      <div id="tooltip" class="tooltip"></div>
        // Help text for each admin feature
        const adminHelp = [
          { title: 'Animora AI', help: 'Access the conversational AI chat system for animal health queries and support.' },
          { title: 'API Backend', help: 'Check the status and logs of the backend API powering the site and AI.' },
          { title: 'Main Website', help: 'View the public-facing website as visitors see it.' },
          { title: 'Disease Database', help: 'Add, edit, or remove disease information for the AI and website.' },
          { title: 'Manage Vets', help: 'Add, update, or remove veterinarians displayed on the website.' },
          { title: 'Manage Team', help: 'Edit staff/team members shown on the public site.' },
          { title: 'Manage Services', help: 'Edit the list of veterinary services offered.' },
          { title: 'Contact Info', help: 'Update clinic contact details, phone numbers, and hours.' },
          { title: 'About Content', help: 'Edit the About page content and mission statement.' },
          { title: 'Settings', help: 'Configure security, ports, and other admin settings.' },
          { title: 'Appointments', help: 'View and manage appointment bookings.' },
          { title: 'Testimonials', help: 'Manage client reviews and testimonials.' },
          { title: 'Photo Gallery', help: 'Upload and organize images for the website gallery.' },
          { title: 'Quick Stats', help: 'View analytics and quick statistics for the website.' },
          { title: 'Notifications', help: 'See recent activity and alerts for the site.' },
          { title: 'File Manager', help: 'Browse and manage uploaded files and documents.' },
          { title: 'Floating Blog Button', help: 'Configure the floating blog link button on the public site.' },
          { title: 'Site Health Check', help: 'Monitor site integrity, uptime, and issues.' },
          { title: 'Security Scanner', help: 'Scan for vulnerabilities and security threats.' },
          { title: 'SEO Optimizer', help: 'Optimize site content for better search engine ranking.' },
          { title: 'Backup & Restore', help: 'Manage automated backups and restore site data.' },
          { title: 'Performance Monitor', help: 'Check speed and optimization metrics.' },
          { title: 'Code Validator', help: 'Validate HTML, CSS, and JS code quality.' }
        ];

        // Card HTML for admin features with help icons
        const adminCards = [
          { href: '../animora-ai/chat.html', icon: 'ü§ñ', title: 'Animora AI', desc: 'Access the complete AI chat system', cls: 'ai', target: '_blank' },
            { href: '/api/util?action=chat', icon: 'üíæ', title: 'API Backend', desc: 'View backend API status', cls: 'database', target: '_blank' },
          { href: '../index.html', icon: 'üåê', title: 'Main Website', desc: 'View public website', cls: 'website' },
          { href: '/admin/diseases.html', icon: 'ü¶†', title: 'Disease Database', desc: 'Manage disease information', cls: 'analytics' },
          { href: '/admin/vets.html', icon: 'üë®‚Äç‚öïÔ∏è', title: 'Manage Vets', desc: 'Add and manage veterinarians' },
          { href: '/admin/staff-manager.html', icon: 'üë•', title: 'Manage Team', desc: 'Edit staff/team members on website', cls: 'website' },
          { href: '/admin/services-manager.html', icon: 'üè•', title: 'Manage Services', desc: 'Edit services offered on website', cls: 'ai' },
          { href: '/admin/contact-manager.html', icon: 'üìû', title: 'Contact Info', desc: 'Update contact details & hours', cls: 'database' },
          { href: '/admin/about-manager.html', icon: 'üìù', title: 'About Content', desc: 'Edit about page content', cls: 'analytics' },
          { href: '/admin/settings.html', icon: '‚öôÔ∏è', title: 'Settings', desc: 'Security & configuration', cls: 'website' },
          { href: '/admin/appointments.html', icon: 'üìÖ', title: 'Appointments', desc: 'View & manage bookings', cls: 'ai' },
          { href: '/admin/testimonials.html', icon: '‚≠ê', title: 'Testimonials', desc: 'Manage client reviews', cls: 'database' },
          { href: '/admin/gallery.html', icon: 'üì∏', title: 'Photo Gallery', desc: 'Upload & organize images', cls: 'analytics' },
          { href: '/admin/quick-stats.html', icon: 'üìä', title: 'Quick Stats', desc: 'View website analytics' },
          { href: '/admin/notifications.html', icon: 'üîî', title: 'Notifications', desc: 'Recent activity & alerts', cls: 'website' },
          { href: '/admin/file-manager.html', icon: 'üìÅ', title: 'File Manager', desc: 'Browse & manage files', cls: 'ai' },
          { href: '/admin/floating-blog.html', icon: 'üìù', title: 'Floating Blog Button', desc: 'Configure blog link button', cls: 'database' },
          { href: '/admin/site-health.html', icon: 'üè•', title: 'Site Health Check', desc: 'Monitor site integrity & issues', cls: 'ai' },
          { href: '/admin/security-scanner.html', icon: 'üîí', title: 'Security Scanner', desc: 'Detect vulnerabilities & threats', cls: 'analytics' },
          { href: '/admin/seo-optimizer.html', icon: 'üöÄ', title: 'SEO Optimizer', desc: 'Improve Google ranking' },
          { href: '/admin/backup-restore.html', icon: 'üíæ', title: 'Backup & Restore', desc: 'Automated backups & recovery', cls: 'website' },
          { href: '/admin/performance-monitor.html', icon: '‚ö°', title: 'Performance Monitor', desc: 'Speed & optimization metrics', cls: 'database' },
          { href: '/admin/code-validator.html', icon: '‚úÖ', title: 'Code Validator', desc: 'Check HTML/CSS/JS quality', cls: 'ai' }
        ];

        // Inject admin cards with help icons
        function renderAdminCards() {
          const grid = document.getElementById('adminGrid');
          grid.innerHTML = '';
          adminCards.forEach((card, i) => {
            const a = document.createElement('a');
            a.href = card.href;
            a.className = 'admin-card' + (card.cls ? ' ' + card.cls : '');
            if (card.target) a.target = card.target;
            a.innerHTML = `
              <div class="icon">${card.icon}</div>
              <h3>${card.title} <span class="help-icon" data-index="${i}" tabindex="0" aria-label="Help">‚ùì</span></h3>
              <p>${card.desc}</p>
            `;
            grid.appendChild(a);
          });
        }

        // Tooltip logic
        function setupTooltips() {
          const tooltip = document.getElementById('tooltip');
          document.querySelectorAll('.help-icon').forEach(icon => {
            icon.addEventListener('mouseenter', function(e) {
              const idx = this.getAttribute('data-index');
              tooltip.textContent = adminHelp[idx]?.help || '';
              const rect = this.getBoundingClientRect();
              tooltip.style.display = 'block';
              tooltip.style.left = (rect.left + window.scrollX + 24) + 'px';
              tooltip.style.top = (rect.top + window.scrollY - 8) + 'px';
            });
            icon.addEventListener('mouseleave', function() {
              tooltip.style.display = 'none';
            });
            icon.addEventListener('focus', function(e) {
              const idx = this.getAttribute('data-index');
              tooltip.textContent = adminHelp[idx]?.help || '';
              const rect = this.getBoundingClientRect();
              tooltip.style.display = 'block';
              tooltip.style.left = (rect.left + window.scrollX + 24) + 'px';
              tooltip.style.top = (rect.top + window.scrollY - 8) + 'px';
            });
            icon.addEventListener('blur', function() {
              tooltip.style.display = 'none';
            });
          });
          // Hide tooltip on scroll
          window.addEventListener('scroll', () => { tooltip.style.display = 'none'; });
        }

        window.addEventListener('DOMContentLoaded', function() {
          renderAdminCards();
          setupTooltips();
          // ...existing code...
        });
    </div>

    <div class="status-bar">
      <h4>System Status</h4>
      <div class="status-item">
        <span><span class="status-indicator online"></span>Animora AI Frontend</span>
        <span>Port 3000</span>
      </div>
      <div class="status-item">
        <span><span class="status-indicator online"></span>Backend API</span>
        <span>Port 4001</span>
      </div>
      <div class="status-item">
        <span><span class="status-indicator online"></span>MongoDB Database</span>
        <span>Cloud Connected</span>
      </div>
      <div class="status-item">
        <span><span class="status-indicator online"></span>AI Provider</span>
        <span id="aiProvider">Groq API</span>
      </div>
      <div class="status-item">
        <span><span class="status-indicator online"></span>CMS System</span>
        <span><a href="cms-test.html" style="color: #16A34A; text-decoration: none;">Test CMS ‚Üí</a></span>
      </div>
    </div>

    <button class="logout-btn" onclick="window.location.href='../index.html'">Return to Main Site</button>
  </div>

  <script>
    // Improved service status check for production
    async function checkServices() {
      const indicators = document.querySelectorAll('.status-indicator');
      // Check frontend (current domain and port)
      try {
        await fetch(window.location.origin, { mode: 'no-cors' });
        indicators[0].classList.remove('offline');
        indicators[0].classList.add('online');
      } catch (e) {
        indicators[0].classList.remove('online');
        indicators[0].classList.add('offline');
      }

      // Check backend API (example: /api/util?action=chat)
      try {
        const res = await fetch('/api/util?action=chat', { method: 'OPTIONS' });
        if (!res.ok) throw new Error();
        indicators[1].classList.remove('offline');
        indicators[1].classList.add('online');
      } catch (e) {
        indicators[1].classList.remove('online');
        indicators[1].classList.add('offline');
      }
      // MongoDB status check
      try {
        const res = await fetch('/api/mongo-status', { method: 'GET' });
        if (!res.ok) throw new Error();
        indicators[2].classList.remove('offline');
        indicators[2].classList.add('online');
      } catch (e) {
        indicators[2].classList.remove('online');
        indicators[2].classList.add('offline');
      }

      // AI Provider status check
      try {
        const res = await fetch('/api/ai-provider-status', { method: 'GET' });
        if (!res.ok) throw new Error();
        indicators[3].classList.remove('offline');
        indicators[3].classList.add('online');
      } catch (e) {
        indicators[3].classList.remove('online');
        indicators[3].classList.add('offline');
      }

      // CMS status check
      try {
        const res = await fetch('/api/cms-status', { method: 'GET' });
        if (!res.ok) throw new Error();
        indicators[4].classList.remove('offline');
        indicators[4].classList.add('online');
      } catch (e) {
        indicators[4].classList.remove('online');
        indicators[4].classList.add('offline');
      }
    }

    // Add Fix Suggestion button logic (improved for page errors)
    window.addEventListener('DOMContentLoaded', function() {
      document.querySelectorAll('.fix-suggestion').forEach(btn => {
        btn.addEventListener('click', function() {
          // Try to detect port and show actionable dialog
          let port = window.location.port || (window.location.protocol === 'https:' ? '443' : '80');
          let docLink = 'https://github.com/Sav-Duke/animora-veterinary#deployment';
          alert(
            'Ensure your web server is running and accessible on port ' + port + '.\n' +
            'If you are using a cloud server, check firewall rules.\n' +
            'For more help, see deployment documentation:\n' + docLink
          );
        });
      });
    });

    checkServices();
    setInterval(checkServices, 30000); // Check every 30 seconds
  </script>
</body>
</html>
