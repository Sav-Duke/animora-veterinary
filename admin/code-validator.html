<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Code Validator | Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', sans-serif; background: #f3f4f6; padding: 20px; }
    .container { max-width: 1200px; margin: 0 auto; }
    .header { background: white; padding: 30px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; }
    .header h1 { color: #16A34A; display: flex; align-items: center; gap: 12px; }
    .back-btn { background: #6b7280; color: white; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; text-decoration: none; }
    .validation-score { background: linear-gradient(135deg, #16A34A 0%, #15803d 100%); color: white; padding: 40px; border-radius: 12px; text-align: center; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(22, 163, 74, 0.3); }
    .validation-score h2 { font-size: 4rem; margin-bottom: 10px; }
    .scan-btn { background: linear-gradient(135deg, #16A34A 0%, #15803d 100%); color: white; padding: 15px 30px; border: none; border-radius: 10px; cursor: pointer; font-size: 1.1rem; font-weight: 600; width: 100%; margin-bottom: 20px; }
    .validation-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; margin-bottom: 20px; }
    .validation-card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    .validation-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .validation-header h3 { color: #374151; }
    .status-icon { font-size: 2.5rem; }
    .issue-list { margin-top: 15px; }
    .issue-item { padding: 12px; background: #fee2e2; border-left: 4px solid #dc2626; margin-bottom: 8px; border-radius: 6px; }
    .issue-item.warning { background: #fef3c7; border-color: #f59e0b; }
    .issue-item h5 { color: #374151; margin-bottom: 5px; font-size: 0.9rem; }
    .issue-item p { color: #6b7280; font-size: 0.85rem; }
    .best-practices { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    .best-practices h3 { color: #374151; margin-bottom: 20px; }
    .practice-item { padding: 15px; background: #f0fdf4; border-left: 4px solid #16A34A; margin-bottom: 10px; border-radius: 6px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1><span>‚úÖ</span>Code Validator</h1>
      <a href="index.html" class="back-btn">‚Üê Back</a>
    </div>

    <div class="validation-score">
      <h2 id="validationScore">--</h2>
      <p id="validationLabel">Click "Validate Code Quality" to check</p>
    </div>

    <button class="scan-btn" onclick="validateCode()">üîç Validate Code Quality</button>

    <div style="margin: 30px 0;">
      <h2 style="color:#374151;">Code Validation Results</h2>
      <button class="fix-btn" onclick="showAddValidationForm()">‚ûï Add Validation Result</button>
      <div id="validationList"></div>
      <div id="validationFormContainer" style="display:none;"></div>
    </div>

    <div class="validation-grid" id="validationGrid"></div>

    <div class="best-practices" id="bestPractices" style="display: none;">
      <h3>‚ú® Code Quality Best Practices</h3>
      <div class="practice-item">
        <h4 style="color: #374151; margin-bottom: 5px;">‚úÖ Semantic HTML</h4>
        <p style="color: #6b7280; font-size: 0.9rem;">Use proper HTML5 semantic tags (header, nav, main, article, section, footer) for better structure and accessibility.</p>
      </div>
      <div class="practice-item">
        <h4 style="color: #374151; margin-bottom: 5px;">‚úÖ CSS Organization</h4>
        <p style="color: #6b7280; font-size: 0.9rem;">Organize CSS with consistent naming conventions, avoid !important, and use CSS variables for maintainability.</p>
      </div>
      <div class="practice-item">
        <h4 style="color: #374151; margin-bottom: 5px;">‚úÖ JavaScript Best Practices</h4>
        <p style="color: #6b7280; font-size: 0.9rem;">Use const/let instead of var, avoid global variables, use strict mode, and handle errors properly.</p>
      </div>
      <div class="practice-item">
        <h4 style="color: #374151; margin-bottom: 5px;">‚úÖ Accessibility Standards</h4>
        <p style="color: #6b7280; font-size: 0.9rem;">Include alt text for images, proper ARIA labels, keyboard navigation support, and sufficient color contrast.</p>
      </div>
      <div class="practice-item">
        <h4 style="color: #374151; margin-bottom: 5px;">‚úÖ Performance Optimization</h4>
        <p style="color: #6b7280; font-size: 0.9rem;">Minify CSS/JS for production, compress images, lazy load resources, and eliminate render-blocking resources.</p>
      </div>
    </div>
  </div>

  <script>
    const validationChecks = [
      {
        category: 'HTML Validation',
        icon: 'üìÑ',
        checks: [
          { name: 'DOCTYPE declaration', status: 'pass', message: 'All pages have proper DOCTYPE' },
          { name: 'Meta charset', status: 'pass', message: 'UTF-8 encoding specified' },
          { name: 'Viewport meta tag', status: 'pass', message: 'Mobile viewport configured' },
          { name: 'Semantic HTML5', status: 'pass', message: 'Using semantic tags (header, nav, main, footer)' },
          { name: 'Proper nesting', status: 'pass', message: 'HTML elements properly nested' }
        ]
      },
      {
        category: 'CSS Validation',
        icon: 'üé®',
        checks: [
          { name: 'Valid CSS syntax', status: 'pass', message: 'No CSS syntax errors detected' },
          { name: 'Vendor prefixes', status: 'warning', message: 'Consider adding vendor prefixes for better compatibility' },
          { name: 'CSS organization', status: 'pass', message: 'Separate CSS files for different sections' },
          { name: 'Responsive design', status: 'pass', message: 'Media queries implemented' },
          { name: 'CSS variables', status: 'warning', message: 'Consider using CSS custom properties for theming' }
        ]
      },
      {
        category: 'JavaScript Quality',
        icon: 'üíª',
        checks: [
          { name: 'Modern JS syntax', status: 'pass', message: 'Using const/let, arrow functions' },
          { name: 'Error handling', status: 'pass', message: 'Try-catch blocks in async code' },
          { name: 'Code organization', status: 'pass', message: 'Modular code structure' },
          { name: 'Event listeners', status: 'pass', message: 'Proper event binding' },
          { name: 'Memory leaks', status: 'pass', message: 'No obvious memory leak patterns' }
        ]
      },
      {
        category: 'Accessibility',
        icon: '‚ôø',
        checks: [
          { name: 'Alt text for images', status: 'warning', message: 'Some images missing alt attributes' },
          { name: 'Form labels', status: 'pass', message: 'All form inputs have labels' },
          { name: 'Color contrast', status: 'pass', message: 'Sufficient contrast ratios' },
          { name: 'Keyboard navigation', status: 'pass', message: 'Site is keyboard navigable' },
          { name: 'ARIA attributes', status: 'warning', message: 'Consider adding ARIA labels for complex widgets' }
        ]
      },
      {
        category: 'Performance',
        icon: '‚ö°',
        checks: [
          { name: 'Minified resources', status: 'warning', message: 'CSS/JS not minified (recommended for production)' },
          { name: 'Image optimization', status: 'pass', message: 'Images are reasonably sized' },
          { name: 'Caching strategy', status: 'warning', message: 'Set cache headers for static resources' },
          { name: 'Lazy loading', status: 'warning', message: 'Consider lazy loading images below the fold' },
          { name: 'Code splitting', status: 'pass', message: 'JavaScript loaded as needed' }
        ]
      },
      {
        category: 'Security',
        icon: 'üîí',
        checks: [
          { name: 'Input sanitization', status: 'pass', message: 'User inputs validated' },
          { name: 'XSS protection', status: 'pass', message: 'Content properly escaped' },
          { name: 'HTTPS usage', status: 'warning', message: 'HTTPS recommended for production' },
          { name: 'Secure headers', status: 'warning', message: 'Add security headers (CSP, X-Frame-Options)' },
          { name: 'Dependencies', status: 'pass', message: 'Using latest stable versions' }
        ]
      }
    ];

    function validateCode() {
      const btn = event.target;
      btn.disabled = true;
      btn.innerHTML = '‚è≥ Validating code...';

      let totalChecks = 0;
      let passedChecks = 0;

      validationChecks.forEach(category => {
        category.checks.forEach(check => {
          totalChecks++;
          if (check.status === 'pass') passedChecks++;
        });
      });

      const score = Math.round((passedChecks / totalChecks) * 100);
      document.getElementById('validationScore').textContent = score + '/100';

      const scoreElement = document.querySelector('.validation-score');
      const labelElement = document.getElementById('validationLabel');

      if (score >= 85) {
        labelElement.textContent = '‚úÖ Excellent Code Quality!';
        scoreElement.style.background = 'linear-gradient(135deg, #16A34A 0%, #15803d 100%)';
      } else if (score >= 70) {
        labelElement.textContent = '‚ö†Ô∏è Good Quality - Minor improvements suggested';
        scoreElement.style.background = 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)';
      } else {
        labelElement.textContent = '‚ùå Needs Improvement';
        scoreElement.style.background = 'linear-gradient(135deg, #dc2626 0%, #b91c1c 100%)';
      }

      displayValidationResults();
      document.getElementById('bestPractices').style.display = 'block';

      btn.disabled = false;
      btn.innerHTML = 'üîç Validate Code Quality';
    }

    function displayValidationResults() {
      const grid = document.getElementById('validationGrid');
      grid.innerHTML = '';

      validationChecks.forEach(category => {
        const passCount = category.checks.filter(c => c.status === 'pass').length;
        const totalCount = category.checks.length;
        const categoryStatus = passCount === totalCount ? '‚úÖ' : passCount > totalCount / 2 ? '‚ö†Ô∏è' : '‚ùå';

        const card = document.createElement('div');
        card.className = 'validation-card';
        card.innerHTML = `
          <div class="validation-header">
            <h3>${category.icon} ${category.category}</h3>
            <span class="status-icon">${categoryStatus}</span>
          </div>
          <p style="color: #6b7280; margin-bottom: 15px;">${passCount}/${totalCount} checks passed</p>
          <div class="issue-list">
            ${category.checks.map(check => {
              if (check.status !== 'pass') {
                return `
                  <div class="issue-item ${check.status}">
                    <h5>${check.name}</h5>
                    <p>${check.message}</p>
                  </div>
                `;
              }
              return '';
            }).join('')}
          </div>
        `;
        grid.appendChild(card);
      });
    }

    // --- Code Validator CRUD LOGIC ---
    const validatorApi = '/api/ai?action=code-validator';

    async function fetchValidationResults() {
      const res = await fetch(validatorApi);
      const data = await res.json();
      renderValidationList(data);
    }

    function renderValidationList(list) {
      const el = document.getElementById('validationList');
      if (!list.length) {
        el.innerHTML = '<p style="color:#888;">No validation results found.</p>';
        return;
      }
      el.innerHTML = `<table style="width:100%;margin-top:10px;border-collapse:collapse;">
        <tr style="background:#f3f4f6;"><th>File</th><th>Result</th><th>Errors</th><th>Warnings</th><th>Actions</th></tr>
        ${list.map(val => `
          <tr style="border-bottom:1px solid #eee;">
            <td>${val.file}</td>
            <td>${val.result}</td>
            <td>${val.errors.join('<br>')}</td>
            <td>${val.warnings.join('<br>')}</td>
            <td>
              <button class="fix-btn" style="background:#f59e0b;" onclick="showEditValidationForm('${val._id}')">‚úèÔ∏è Edit</button>
              <button class="fix-btn" style="background:#dc2626;" onclick="deleteValidationResult('${val._id}')">üóëÔ∏è Delete</button>
            </td>
          </tr>
        `).join('')}
      </table>`;
    }

    function showAddValidationForm() {
      const c = document.getElementById('validationFormContainer');
      c.innerHTML = `
        <h3>Add Validation Result</h3>
        <form onsubmit="addValidationResult(event)">
          <input required name="file" placeholder="File (e.g. index.html)" style="width:200px;"> <br><br>
          <input required name="result" placeholder="Result (pass/fail)" style="width:120px;"> <br><br>
          <textarea name="errors" placeholder="Errors (one per line)" style="width:300px;height:40px;"></textarea> <br><br>
          <textarea name="warnings" placeholder="Warnings (one per line)" style="width:300px;height:40px;"></textarea> <br><br>
          <button class="fix-btn" type="submit">Add</button>
          <button class="fix-btn" type="button" style="background:#6b7280;" onclick="hideValidationForm()">Cancel</button>
        </form>
      `;
      c.style.display = '';
    }

    function showEditValidationForm(id) {
      fetch(`${validatorApi}&id=${id}`)
        .then(res => res.json())
        .then(val => {
          const c = document.getElementById('validationFormContainer');
          c.innerHTML = `
            <h3>Edit Validation Result</h3>
            <form onsubmit="editValidationResult(event, '${val._id}')">
              <input required name="file" value="${val.file}" style="width:200px;"> <br><br>
              <input required name="result" value="${val.result}" style="width:120px;"> <br><br>
              <textarea name="errors" style="width:300px;height:40px;">${val.errors.join('\n')}</textarea> <br><br>
              <textarea name="warnings" style="width:300px;height:40px;">${val.warnings.join('\n')}</textarea> <br><br>
              <button class="fix-btn" type="submit">Save</button>
              <button class="fix-btn" type="button" style="background:#6b7280;" onclick="hideValidationForm()">Cancel</button>
            </form>
          `;
          c.style.display = '';
        });
    }

    function hideValidationForm() {
      document.getElementById('validationFormContainer').style.display = 'none';
    }

    async function addValidationResult(e) {
      e.preventDefault();
      const f = e.target;
      const body = {
        file: f.file.value.trim(),
        result: f.result.value.trim(),
        errors: f.errors.value.split('\n').map(x=>x.trim()).filter(Boolean),
        warnings: f.warnings.value.split('\n').map(x=>x.trim()).filter(Boolean)
      };
      const res = await fetch(validatorApi, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      });
      if (res.ok) {
        hideValidationForm();
        fetchValidationResults();
      } else {
        alert('Failed to add validation result');
      }
    }

    async function editValidationResult(e, id) {
      e.preventDefault();
      const f = e.target;
      const body = {
        file: f.file.value.trim(),
        result: f.result.value.trim(),
        errors: f.errors.value.split('\n').map(x=>x.trim()).filter(Boolean),
        warnings: f.warnings.value.split('\n').map(x=>x.trim()).filter(Boolean)
      };
      const res = await fetch(`${validatorApi}&id=${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      });
      if (res.ok) {
        hideValidationForm();
        fetchValidationResults();
      } else {
        alert('Failed to update validation result');
      }
    }

    async function deleteValidationResult(id) {
      if (!confirm('Delete this validation result?')) return;
      const res = await fetch(`${validatorApi}&id=${id}`, { method: 'DELETE' });
      if (res.ok) {
        fetchValidationResults();
      } else {
        alert('Failed to delete validation result');
      }
    }

    window.fetchValidationResults = fetchValidationResults;
    window.showAddValidationForm = showAddValidationForm;
    window.showEditValidationForm = showEditValidationForm;
    window.hideValidationForm = hideValidationForm;
    window.addValidationResult = addValidationResult;
    window.editValidationResult = editValidationResult;
    window.deleteValidationResult = deleteValidationResult;

    // Auto-run on load
    window.addEventListener('load', () => {
      setTimeout(validateCode, 500);
      fetchValidationResults();
    });
  </script>
</body>
</html>
